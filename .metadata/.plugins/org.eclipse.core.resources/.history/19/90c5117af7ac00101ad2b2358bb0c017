/**
 ******************************************************************************
 * @file    lis3mdl_platform.c
 * @brief   Hardware abstraction for LIS3MDL on B-L475E-IOT01A2 board.
 *
 * This file connects the generic ST LIS3MDL driver to the specific
 * STM32L475 I2C2 hardware through the BSP layer (stm32l475e_iot01_bus.c).
 *
 * By using this separate file, the main application code stays clean.
 * If you ever switch from I2C to SPI or to a different board,
 * only this file must be changed.
 ******************************************************************************
 */

#include "lis3mdl_conf.h"

/* Create global sensor instance.
 * This object stores internal driver state and bus interface info.
 */
LIS3MDL_Object_t lis3mdl;

/**
 * @brief  Connects LIS3MDL driver to the STM32 I2C2 hardware via BSP.
 */
void LIS3MDL_Platform_Init(void)
{
    LIS3MDL_IO_t io_ctx;

    /* Fill in the IO context with BSP-provided functions.
     * BSP_I2C2_* are already implemented by ST for this board.
     * They internally use HAL_I2C_* but add error handling and timeouts.
     */
    io_ctx.Init    = BSP_I2C2_Init;
    io_ctx.DeInit  = BSP_I2C2_DeInit;
    io_ctx.BusType = LIS3MDL_I2C_BUS;          // The sensor is connected via I2C
    io_ctx.Address = LIS3MDL_I2C_ADD_H;        // 0x3D (8-bit I2C address)
    io_ctx.WriteReg= BSP_I2C2_WriteReg;
    io_ctx.ReadReg = BSP_I2C2_ReadReg;
    io_ctx.GetTick = HAL_GetTick;              // Millisecond tick source
    io_ctx.Delay   = HAL_Delay;                // Simple blocking delay

    /* Register the above interface with the LIS3MDL driver.
     * After this call, the driver knows how to communicate with the hardware.
     */
    LIS3MDL_RegisterBusIO(&lis3mdl, &io_ctx);
}
