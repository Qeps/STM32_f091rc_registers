/**
 ******************************************************************************
 * @file           : main.c
 * @author         : Auto-generated by STM32CubeIDE
 * @brief          : Main program body
 ******************************************************************************
 * @attention
 *
 * Copyright (c) 2025 STMicroelectronics.
 * All rights reserved.
 *
 * This software is licensed under terms that can be found in the LICENSE file
 * in the root directory of this software component.
 * If no LICENSE file comes with this software, it is provided AS-IS.
 *
 ******************************************************************************
 */
#include "main.h"

// PA5 LD2
// Zegarami sterujemy w bloku RCC
void configureLD2(void);

int main(void)
{
	configureLD2();
    /* Loop forever */
	for(;;);
}

void configureLD2(void){
	//Zgodnie z dokumentacją by włączyć zegar dla portu A dla pinu PA5 musimy ustawić 17 bit rejestru AHBENR,
	//AHB(Advanced High-performance Bus) peripheral clock enable register. Magistrala w architekturze AMBA.
	//Można to zrobic tak: RCC->AHBENR |= (1<<17); albo lepiej
	RCC->AHBENR |= RCC_AHBENR_GPIOAEN;

	//Kolejny krok to ustawienie trybu odpowiedniego pinu znajdującego się na danym porcie (GPIOA)
	//Nalezy wykorzystac do tego celu GPIOx_MODER
	GPIOA->MODER |= GPIO_MODER_MODER5_0; 		//bit zerowy - młodszy ustawiamy na "1" tryb pracy 01 - output
	GPIOA->MODER &= ~(GPIO_MODER_MODER5_1);		//bit pierwszt - starszy ustawiamy na "0" tryb pracy 01 - output

	//Kolejny rejestr to konfiguracja tryby output
	//tryb push-pull: pin aktywnie wystawia 0 i 1, brak potrzeby rezystora podciągającego
	//tryb open-drain: pin tylko ściąga do 0, stan wysoki przez rezystor pull-up
	//open-drain pozwala na współdzielenie linii przez wiele urządzeń (np. I2C)
	GPIOA->OTYPER &= ~(GPIO_OTYPER_OT_5);

	//Rejestr GPIOx_OSPEEDR ustawia szybkość narastania sygnału na pinie
	//wyższa szybkość = szybsze zbocza, ale większe zakłócenia i pobór prądu
	//dobierz prędkość do długości ścieżki i częstotliwości sygnału
	GPIOA->OSPEEDR &= ~(GPIO_OSPEEDER_OSPEEDR5); //ustawiamy oba na raz

	//Rejestr GPIOx_PUPDR ustawia wewnętrzne rezystory podciągające lub ściągające pin
	//używany głównie w trybie input, aby uniknąć nieokreślonego stanu logicznego
	//dla wyjść (np. sterowanie diodą) ustawia się zwykle 00 – bez podciągania
	GPIOA->PUPDR &= ~(GPIO_PUPDR_PUPDR5); 		//ustawiamy oba na 00
}
